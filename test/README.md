# unit test cloud.sh

This documentation is for developper and is in English.

## requierement

- [bats-core](https://github.com/bats-core/bats-core)
- a valid OVH api config in ovh.conf (See: `mk_cred.py`)
- configure your test environment (See below)

## WARNING

A public cloud VM instance is deleted by the test runner. It sould be safe and will not delete any non testing instance.

Use it at your own risk.

## run tests

```bash
cd test
bats .
```

## testing creates local files

Some files are left intentionnaly in the `test/` folder:

```
delete_instance         <== openstack id of the instance to delete
instance.json           <== JSON output of the vm created
log                     <== internal bats states loging
o_escaped_file.json     <== string generated by preprocess_init() function
tmp_validate.json       <== content passed to _assert_json_valid() for manual review
```

## configuration for testing

Configuration is stored in

`test_config.bash`

```bash
#!/usr/bin/env bash
#
# configuration for the tests

# must exactly match ssh key in the project
# after setting the project you cat list sshkeys with:
# run: ./cloud.sh list_ssh
SSHKEY_NAME=my_ssh_key_name

# some domain name managed on OVH
# this domain name will be used to name instance
DOMAIN_NAME=managed-domaine.com

# the kind of VM we could create during test
TEST_FLAVOR_NAME=s1-2

# A regexp to find the image for the distribution
# Our code has a limitation on parameter transmission and space must be
# matched by a . regexp pattern.
DISTRIB_IMAGE='Debian.10$'

CONFFILE=./mycloud.conf
```

